;=========================================================================================; Vista and Delmar Occupancy LEDs ;; Entry: Bank3; Exit: Bank3; RAM used: Param78, XReg, YReg; Calls: () GetCurBlkY, Output;LightOccLEDs	MOVLW	low BlockOccLEDs	MOVWF	CurBlk	MOVLW	high BlockOccLEDs	ADDLW	low evDataROM	MOVWF	CurBlk+1LightOccLEDs_L1	CLRF	YReg	;Block number	CLRF	OActive	CALL	GetCurBlkY_D18	INCF	Param78,F	;EOD is 0xFF	SKPNZ	RETURN	MOVWF	XReg	LCALL	GetBlockPwrTableX	ANDLW	0x60	;Detect east and west	SKPZ	BSF	OActive,7	INCF	YReg,F	;output bit	INCF	YReg,F	;output slot and board	CALL	GetCurBlkY_D18	BTFSS	Param78,7	;Output board?	GOTO	LightOccLEDs_Bmdl	ANDLW	0x07	MOVWF	OBoard	DECF	YReg,F	CALL	GetCurBlkY_D18	;output bit	MOVWF	OBit	CALL	Output	GOTO	LightOccLEDs_End;LightOccLEDs_Bmdl	MOVWF	XReg	;Put Block# in XReg	LCALL	RestoreBlkModBits	;Move the block's LED bits into ram.	DECF	YReg,F	CALL	GetCurBlkY_D18	;output bit	CALL	SetBlockModuleLED;LightOccLEDs_End	MOVLW	0x03	ADDWF	CurBlk,F	ADDCF	CurBlk+1,F	GOTO	LightOccLEDs_L1;;=========================================================================================; Light Track 365 selected LED;Loop7;=========================================================================================; Underhill East Ladder;; sample data;------------------------------------------;AuxSMLEDsData	DW	d'76'+SMOffRouteFlag;	DW	d'77'+SMOffRouteFlag;	DW	None	;Marks end of SMs;	DB	BlkNum370	;Root block;	DW	0x370A	;LED;	DW	None	;optional 2nd LED (Not Used);;	DB	EOD;	DB	EOD;------------------------------------------;OddLEDs	MOVLW	high AuxSMLEDsData	ADDLW	low evDataROM	MOVWF	CurBlk+1	MOVLW	low AuxSMLEDsData	MOVWF	CurBlkOddLEDs_L2	CLRF	YReg	;LSB of first SM;	BSF	Param7A,7OddLEDs_L1	INCF	YReg,F	CALL	GetCurBlkY_D18	;SM# MSB	MOVWF	Param74	SUBLW	EOD	SKPNZ		;Are we past the end?	GOTO	OddLEDs_end	; Yes;	MOVLW	high None	SUBWF	Param78,W	SKPNZ		;Last SM already done?	GOTO	OddLEDs_Blk	; Yes;	DECF	YReg,F	CALL	GetCurBlkY_D18	;SM# LSB	BTFSS	Param74,SMOffRouteFlagBit	CALL	AndSMwith7A	BTFSC	Param74,SMOffRouteFlagBit	CALL	AndSMNotwith7A	MOVLW	0x02	ADDWF	YReg,F	;next SM# LSB or None	GOTO	OddLEDs_L1; YReg>>MSB of NoneOddLEDs_Blk	DECF	YReg,F	;LSB of None-1	CALL	GetCurBlkY_D18	MOVWF	Param74	;Save ON only flag	INCF	YReg,F	;MSB of None	INCF	YReg,F	;Root block;	if LightUnusedSMLEDs	else	CALL	GetCurBlkY_D18	MOVWF	XReg	;Save Root Block	LCALL	GetCabNumX	SKPNZ	BCF	Param7A,7	endif;	MOVF	Param7A,W	MOVWF	OActive	MOVLW	0x02	ADDWF	YReg,F	;LED MSB	CALL	GetCurBlkY_D18	DECF	YReg,F	;LED Bit#	BTFSC	OActive,7	;Turning it on?	GOTO	OddLEDs_DoLight	; Yes	BTFSC	Param74,1	;ON only flag? (inverted flag)OddLEDs_DoLight	CALL	OddLEDs_LightIt	; No;;	MOVF	Param7A,W;	MOVWF	OActive;	MOVLW	0x03;	ADDWF	YReg,F	;2nd LED MSB;	CALL	GetCurBlkY_D18;	DECF	YReg,F	;LED Bit#;	BTFSS	Param78,7	;none?;	CALL	OddLEDs_LightIt;	OddLEDs_Next	MOVLW	0x02	ADDWF	YReg,W	;1 past end	ADDWF	CurBlk,F	ADDCF	CurBlk+1,F	GOTO	OddLEDs_L2;OddLEDs_end	RETURN;	;---------------------------------	;	OddLEDs_LightIt	BTFSS	Param78,OddSMOBFlagBit	GOTO	OddLEDs_BlkMdlBit;	ANDLW	0x07	MOVWF	OBoard	CALL	GetCurBlkY_D18	MOVWF	OBit	CALL	Output	RETURN;OddLEDs_BlkMdlBit	MOVWF	XReg	;Put Block# in XReg	LCALL	RestoreBlkModBits	;Move the block's LED bits into ram.	CALL	GetCurBlkY_D18	GOTO	SetBlockModuleLED;;----------------------------------------------------;AndSMwith7A	MOVWF	XReg	LCALL	GetSMTableX	BTFSS	Param78,7	;SM is active?	BCF	Param7A,7	;No	RETURN;AndSMNotwith7A	MOVWF	XReg	LCALL	GetSMTableX	BTFSC	Param78,7	;SM is inactive?	BCF	Param7A,7	;No	RETURN;;SetOutputFromParam7A	MOVLW	high evDataROM	MOVWF	SRAM_Addr2	MOVFW	LampTblPtr+1	MOVWF	SRAM_Addr1	MOVFW	LampTblPtr	MOVWF	SRAM_Addr0	CALL	SRAM_ReadPI_D18	mBank3	MOVWF	OBit	CALL	SRAM_ReadPI_D18	mBank3	MOVWF	OBoard	SWAPF	OBoard,W	ANDLW	0x03	MOVWF	OSlot	MOVLW	0x07	ANDWF	OBoard,F	BCF	OActive,7	BTFSC	Param7A,7	BSF	OActive,7	CALL	Output	MOVFW	SRAM_Addr1	MOVWF	LampTblPtr+1	MOVFW	SRAM_Addr0	MOVWF	LampTblPtr	RETURN;;;