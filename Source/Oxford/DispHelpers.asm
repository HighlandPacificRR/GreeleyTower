	subtitle	"DispHelpers.asm"	page;===========================================================================================;;  FileName: DispHelpers.asm;  Date: 5/6/03;  File Version: 1.1;  ;  Author: David M. Flynn;  Company: Oxford V.U.E., Inc.;;============================================================================================; Notes:;       Include in any segment;       General perpose routines for display of;       Volts, Time, Temperature, etc.;;============================================================================================; Revision History;; 1.1      5/6/03	Added Calc_TempF, Calc_TempC, Calc_Volts.;	These routines now use DisplayOrPut so set/clr NumsToNic before calling.; 1.0      5/3/03	First Code.  0x74 bytes;;============================================================================================	ifndef UsesDegsC	constant	UsesDegsC=0	endif	ifndef UsesCalcVolts	constant	UsesCalcVolts=0	endif;============================================================================================; constantskDegChar	EQU	0xDFkZeroC	EQU	d'229'	;Ana value for 0¡CkMaxTemp	EQU	d'565'	;Ana-kZeroC 50¡C;; (Ana-kZeroC) * 64 / kDegC_Cnvt = ¡C * 10kDegC_Cnvt	EQU	d'43'; (Ana-kZeroC) * 64 / kDegF_Cnvt = ¡F * 10kDegF_Cnvt	EQU	d'24'; Ana * 16 / kVolts_Cnvt = volts * 10kVolts_Cnvt	EQU	d'109';;Routines in this file; Name	(additional stack words required) Description;============================================================================================;; Calc_TempF	(0)   Calculate Analog input (W) as ¡F x 10; Calc_TempC	(0)   Calculate Analog input (W) as ¡C x 10; Disp_TempC	(1+3) Display Analog input (W) as #0.0¡C; Disp_TempF	(1+3) Display Analog input (W) as #0.0¡F; Disp_Volts	(1+3) Display Analog input (W) as #0.0v; Calc_Volts	(0)   Calculate Analog input (W) as v x 10;;============================================================================================; Calculate Analog input (W) as ¡F x 10;; Entry: W = offset to adcNLSB; Exit: Param79:Param78; RAM used: Param76, Param77, Param78, Param79, Param7B, FSR; Calls: (1+0) Div16x16;Calc_TempF	BCF	Param7B,1	;Degrees_C=false	BCF	Param7B,2	;DisplayIt=false	GOTO	Disp_Temp_E2;	if UsesDegsC;============================================================================================; Calculate Analog input (W) as ¡C x 10;; Entry: W = offset to adcNLSB; Exit: Param79:Param78; RAM used: Param76, Param77, Param78, Param79, Param7A, Param7B, FSR; Calls: (1+0) Div16x16;Calc_TempC	BSF	Param7B,1	;Degrees_C=true	BCF	Param7B,2	;DisplayIt=false	GOTO	Disp_Temp_E2;	endif;============================================================================================; Display Analog input (W) as #0.0¡C;; Entry: W = offset to adcNLSB; Exit: none; RAM used: Param76, Param77, Param78, Param79, Param7A, Param7B, FSR; Calls: (1+3) Div16x16, Disp_decword, DisplaysW;	if UsesDegsCDisp_TempC	BSF	Param7B,1	;Degrees_C=true	endifDisp_TempCF	BSF	Param7B,2	;DisplayIt=trueDisp_Temp_E2	MOVWF	FSR	BSF	STATUS,IRP	MOVFW	INDF	MOVWF	Param76	;lsb	INCF	FSR,F	MOVFW	INDF	MOVWF	Param77	;msb;Disp_Temp_E3	MOVLW	low kZeroC	SUBWF	Param76,F	SUBBF	Param77,F	MOVLW	high kZeroC	SUBWF	Param77,F; test for <=0	BTFSS	Param77,7	;<0?	GOTO	Disp_TempCF_NZ	;No	CLRF	Param76	;Yes, make it Zero	CLRF	Param77;Disp_TempCF_NZ	;	if UsesFP32; Entry: Param77:Param76 zero adjusted value; Exit: 10x Int16 in Param79:Param78	mBank2	MOVF	Param76,W	MOVWF	AARG+B2	MOVF	Param77,W	MOVWF	AARG+B1	CLRF	AARG+B0	mCall2To3	FLO32;	MOVLW	FP32ConstDegC_Cnvt;	BTFSS	Param7B,1	;¡F ?	MOVLW	FP32ConstDegF_Cnvt	;Yes	mCall2To3	MultAargByDR	IORLW	0x00	SKPNZ	GOTO	Disp_TempCF_NFPE	BSF	_RP1	MOVF	FPFLAGS,W	CALL	Disp_Hex_Byte_D10;Disp_TempCF_NFPE	mCall2To3	INT32	BSF	_RP1	;bank2	MOVF	AARG+B2,W	BTFSS	Param7B,1	;¡F ?	ADDLW	low d'320'	;Yes, add 32.0	MOVWF	Param78	MOVF	AARG+B1,W	MOVWF	Param79;	BTFSC	Param7B,1	;¡F ?;	GOTO	Disp_TempCF_CD	;No	ADDCF	Param79,F	MOVLW	high d'320'	ADDWF	Param79,FDisp_TempCF_CD;	else	MOVLW	0x03	ANDWF	Param77,F	MOVLW	0x06	;x64	MOVWF	Param78	CLRCDisp_TempCF_L1	RLF	Param76,F	RLF	Param77,F	DECFSZ	Param78,F	GOTO	Disp_TempCF_L1;;Div16x16	(0) 16 bit devide RAM13D:RAM13C / RAM13F:RAM13E >> Param79:Param78;	mBank2	MOVFW	Param76	MOVWF	nrator0	MOVFW	Param77	MOVWF	nrator1	MOVLW	kDegC_Cnvt	BTFSS	Param7B,1	;¡F ?	MOVLW	kDegF_Cnvt	;Yes	MOVWF	denom0	CLRF	denom1	LCALL	Div16x16	;returns w/ bank 0 selected	BSF	STATUS,RP1	;bank2	MOVFW	result0	MOVWF	Param78	MOVFW	result1	MOVWF	Param79;	endif;	BCF	STATUS,RP1	;bank0	BTFSS	Param7B,2	;DisplayIt?	RETURN		;No	MOVFW	Param78	MOVWF	Param76	MOVFW	Param79	MOVWF	Param77	BSF	DispDec1pl	LCALL	Disp_decword	MOVLW	kDegChar	LCALL	DisplayOrPut	MOVLW	'C'	BTFSS	Param7B,1	MOVLW	'F'	LCALL	DisplayOrPut	RETURN		;ensure PCLATH is set right;;============================================================================================; Display Analog input (W) as #0.0¡F;; Entry: W = offset to adcNLSB; Exit: none; RAM used:; Calls: (1+3) Div16x16, Disp_decword, DisplaysW;Disp_TempF	BCF	Param7B,1	GOTO	Disp_TempCF;;============================================================================================; Display Analog input (W) as #0.0v;; Entry: W = offset to adcNLSB; Exit: none; RAM used: Param76, Param77, Param78, Param79, Param7A, Param7B, FSR; Calls: (1+3) Div16x16, Disp_decword, DisplaysW;Disp_Volts	BSF	Param7B,2	;DisplayIt=trueDisp_Volts_E2	MOVWF	FSR	BSF	STATUS,IRP	MOVFW	INDF	MOVWF	Param76	;lsb	INCF	FSR,F	MOVFW	INDF	MOVWF	Param77	;msb;Disp_Volts_E3	MOVLW	0x0F	ANDWF	Param77,F;	if UsesFP32; Entry: Param77:Param76  ADC value; Exit: 10x Int16 in Param79:Param78;	mBank2	MOVF	Param76,W	MOVWF	AARG+B2	MOVF	Param77,W	MOVWF	AARG+B1	CLRF	AARG+B0	mCall2To3	FLO32	MOVLW	FP32ConstV_Cnvt	mCall2To3	MultAargByDR	mCall2To3	INT32	BSF	_RP1	;bank2	MOVF	AARG+B2,W	MOVWF	Param78	MOVF	AARG+B1,W	MOVWF	Param79;	else	MOVLW	0x04	;x16	MOVWF	Param78	CLRCDisp_Volts_L1	RLF	Param76,F	RLF	Param77,F	DECFSZ	Param78,F	GOTO	Disp_Volts_L1;;Div16x16	(0) 16 bit devide RAM13D:RAM13C / RAM13F:RAM13E >> Param79:Param78;	mBank2	MOVFW	Param76	MOVWF	nrator0	MOVFW	Param77	MOVWF	nrator1	MOVLW	kVolts_Cnvt	MOVWF	denom0	CLRF	denom1	LCALL	Div16x16	;returns w/ bank 0 selected	BSF	STATUS,RP1	;bank2	MOVFW	result0	MOVWF	Param78	MOVFW	result1	MOVWF	Param79;	endif	BCF	STATUS,RP1	;bank0	BTFSS	Param7B,2	;DisplayIt?	RETURN		;No	MOVFW	Param78	MOVWF	Param76	MOVFW	Param79	MOVWF	Param77	BSF	DispDec1pl	LCALL	Disp_decword	MOVLW	'v'	LCALL	DisplayOrPut	RETURN;	if UsesCalcVolts;============================================================================================; Display Analog input (W) as #0.0v;; Entry: W = offset to adcNLSB; Exit: Param79:Param78 = volts*10; RAM used: Param76, Param77, Param78, Param79, Param7A, Param7B, FSR; Calls: (1+0) Div16x16;Calc_Volts	BCF	Param7B,2	;DisplayIt=false	GOTO	Disp_Volts_E2	endif;;;;;;;;;;;;;;;;;;